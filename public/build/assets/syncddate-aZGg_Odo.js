document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("pickup_date"),n=document.getElementById("return_date"),w=document.getElementById("availability-calendar"),s=document.getElementById("price-summary"),i=document.getElementById("total-price"),g=document.querySelector('input[name="boat_id"]').value,o=document.getElementById("port_id"),u=new URLSearchParams(window.location.search),p=u.get("pickup_date"),v=u.get("return_date"),S=u.get("price"),y=u.get("port_id");p&&(t.value=p),v&&(n.value=v),S&&i&&(i.textContent=`${S}€`,s.style.display="block"),y&&o&&(o.value=y);const E=new FullCalendar.Calendar(w,{themeSystem:"bootstrap",locale:"es",initialView:"dayGridMonth",events:`/reservations/calendar/${g}/${y||o.value}`,dateClick:function(e){t.value?n.value?(t.value=e.dateStr,n.value=""):e.dateStr<=t.value?alert("La fecha de entrega debe ser posterior a la de recogida."):(n.value=e.dateStr,b(t.value,n.value)&&(alert("El rango seleccionado incluye días ya reservados. Por favor, selecciona otras fechas."),D())):t.value=e.dateStr,h(),m(t.value,n.value)}});E.render();function h(){!t.value||!n.value||!o.value||axios.get(`/boats/${g}/daily-price`,{params:{start_date:t.value,end_date:n.value,port_id:o.value}}).then(e=>{const r=e.data.total_price;i.textContent=`${r}€`,s.style.display="block"}).catch(e=>{console.error("Error al calcular el precio:",e),i.textContent="Error",s.style.display="none"})}function m(e,r){if(document.querySelectorAll(".fc-day").forEach(a=>a.style.backgroundColor=""),e&&r){let a=new Date(e);const c=new Date(r);for(;a<=c;){const d=a.toISOString().split("T")[0],l=document.querySelector(`.fc-day[data-date="${d}"]`);l&&(l.style.backgroundColor="#007BFF"),a.setDate(a.getDate()+1)}}}function b(e,r){const a=new Date(e),c=new Date(r);return E.getEvents().some(d=>{if(!d.extendedProps.available){const l=new Date(d.startStr),f=new Date(d.endStr);return a>=l&&a<f||c>l&&c<=f||a<=l&&c>=f}return!1})}function D(){t.value="",n.value="",s.style.display="none",m()}p&&v&&(h(),m(p,v))});
