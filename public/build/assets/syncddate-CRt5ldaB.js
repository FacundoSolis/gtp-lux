document.addEventListener("DOMContentLoaded",function(){const a=document.getElementById("pickup_date"),r=document.getElementById("return_date"),b=document.getElementById("availability-calendar"),s=document.getElementById("price-summary"),o=document.getElementById("total-price"),g=document.getElementById("hidden-price"),w=document.getElementById("reservation-form"),E=document.querySelector('input[name="boat_id"]').value,c=document.getElementById("port_id"),u=new URLSearchParams(window.location.search),v=u.get("pickup_date"),p=u.get("return_date"),h=u.get("price"),m=u.get("port_id");v&&(a.value=v),p&&(r.value=p),h&&o&&(o.textContent=`${h}€`,s.style.display="block"),m&&c&&(c.value=m);const S=new FullCalendar.Calendar(b,{themeSystem:"bootstrap",locale:"es",initialView:"dayGridMonth",events:`/reservations/calendar/${E}/${m||c.value}`,dateClick:function(e){a.value?r.value?(a.value=e.dateStr,r.value=""):e.dateStr<=a.value?alert("La fecha de entrega debe ser posterior a la de recogida."):(r.value=e.dateStr,D(a.value,r.value)&&(alert("El rango seleccionado incluye días ya reservados. Por favor, selecciona otras fechas."),_())):a.value=e.dateStr,I(),y(a.value,r.value)}});S.render();function I(){!a.value||!r.value||!c.value||axios.get(`/boats/${E}/daily-price`,{params:{start_date:a.value,end_date:r.value,port_id:c.value}}).then(e=>{const t=e.data.total_price;o.textContent=`${t}€`,g.value=t,s.style.display="block"}).catch(e=>{console.error("Error al calcular el precio:",e),o.textContent="Error",s.style.display="none"})}w.addEventListener("submit",function(e){const t=o.textContent.replace("€","").trim();if(!t||t==="Error"){e.preventDefault(),alert("Por favor selecciona fechas válidas para calcular el precio.");return}g.value=t});function y(e,t){if(document.querySelectorAll(".fc-day").forEach(n=>n.style.backgroundColor=""),e&&t){let n=new Date(e);const d=new Date(t);for(;n<=d;){const i=n.toISOString().split("T")[0],l=document.querySelector(`.fc-day[data-date="${i}"]`);l&&(l.style.backgroundColor="#007BFF"),n.setDate(n.getDate()+1)}}}function D(e,t){const n=new Date(e),d=new Date(t);return S.getEvents().some(i=>{if(!i.extendedProps.available){const l=new Date(i.startStr),f=new Date(i.endStr);return n>=l&&n<f||d>l&&d<=f||n<=l&&d>=f}return!1})}function _(){a.value="",r.value="",s.style.display="none",y()}v&&p&&(I(),y(v,p))});
